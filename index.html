<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta
      name="description"
      content="ECON: Explicit Clothed humans Obtained from Normals"
    />
    <meta
      name="keywords"
      content="ECON, ICON, Neural Fields, Virtual Avatars, Human Digitization, Metaverse"
    />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>ECON: Explicit Clothed humans Obtained from Normals</title>

    <!-- Google tag (gtag.js) -->
    <script
      async
      src="https://www.googletagmanager.com/gtag/js?id=G-E0HR9YQK2K"
    ></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag() {
        dataLayer.push(arguments);
      }
      gtag("js", new Date());

      gtag("config", "G-E0HR9YQK2K");
    </script>

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <link
      href="https://fonts.googleapis.com/css?family=Google+Sans|Noto+Sans|Castoro"
      rel="stylesheet"
    />

    <link rel="stylesheet" href="./static/css/bulma.min.css" />
    <link rel="stylesheet" href="./static/css/bulma-carousel.min.css" />
    <link rel="stylesheet" href="./static/css/bulma-slider.min.css" />
    <link rel="stylesheet" href="./static/css/fontawesome.all.min.css" />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/gh/jpswalsh/academicons@1/css/academicons.min.css"
    />
    <link rel="stylesheet" href="./static/css/index.css" />

    <style>
      .center {
        display: block;
        margin-left: auto;
        margin-right: auto;
        border-radius: 10px;
      }
      .render_wrapper {
        position: relative;
        height: 300px;
      }
      .render_wrapper_small {
        position: relative;
        height: 300px;
      }
      .render_div {
        position: absolute;
        top: 0;
        left: 0;
      }

      .nested-columns {
        margin-bottom: 0 !important;
      }
    </style>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script defer src="./static/js/fontawesome.all.min.js"></script>
    <script src="./static/js/bulma-carousel.min.js"></script>
    <script src="./static/js/bulma-slider.min.js"></script>
    <script src="https://unpkg.com/interactjs/dist/interact.min.js"></script>
    <script src="./static/js/index.js"></script>
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}});
    </script>
    <script
      type="text/javascript"
      src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"
    ></script>
  </head>

  <body>
    <section class="hero">
      <div class="hero-body">
        <div class="container is-max-desktop">
          <div class="columns is-centered">
            <div class="column has-text-centered">
              <h1 class="title is-1 publication-title">
                <span style="color: #10768c">ECON</span>:
                <span style="color: #10768c">E</span>xplicit
                <span style="color: #10768c">C</span>lothed humans<br />
                <span style="color: #10768c">O</span>btained from
                <span style="color: #10768c">N</span>ormals
              </h1>
              <div class="is-size-5 publication-authors">
                <span class="author-block">
                  <a href="http://xiuyuliang.cn/">Yuliang Xiu</a
                  ><sup>1</sup>,</span
                >
                <span class="author-block">
                  <a href="https://ps.is.tuebingen.mpg.de/person/jyang"
                    >Jinlong Yang</a
                  ><sup>1</sup>,</span
                >
                <span class="author-block">
                  <a href="https://hoshino042.github.io/homepage/">Xu Cao</a
                  ><sup>2</sup>,
                </span>
                <span class="author-block">
                  <a href="https://ps.is.mpg.de/~dtzionas">Dimitrios Tzionas</a
                  ><sup>3</sup>,
                </span>
                <span class="author-block">
                  <a href="https://ps.is.tuebingen.mpg.de/person/black"
                    >Michael J. Black</a
                  ><sup>1</sup>,
                </span>
              </div>

              <div class="is-size-5 publication-authors">
                <span class="author-block"
                  ><sup>1</sup>Max Planck Institute for Intelligent
                  Systems,</span
                >
                <span class="author-block"><sup>2</sup>Osaka University</span>
                <span class="author-block"
                  ><sup>3</sup>University of Amsterdam</span
                >
              </div>

              <div class="column has-text-centered">
                <div class="publication-links">
                  <!-- PDF Link. -->
                  <span class="link-block">
                    <a
                      href="https://arxiv.org/abs/2212.07422"
                      class="external-link button is-normal is-rounded is-dark"
                    >
                      <span class="icon">
                        <i class="fas fa-file-pdf"></i>
                      </span>
                      <span>Paper</span>
                    </a>
                  </span>
                  <span class="link-block">
                    <a
                      href="https://www.youtube.com/watch?v=j5hw4tsWpoY"
                      class="external-link button is-normal is-rounded is-dark"
                    >
                      <span class="icon">
                        <svg
                          class="svg-inline--fa fa-youtube fa-w-18"
                          aria-hidden="true"
                          focusable="false"
                          data-prefix="fab"
                          data-icon="youtube"
                          role="img"
                          xmlns="http://www.w3.org/2000/svg"
                          viewBox="0 0 576 512"
                          data-fa-i2svg=""
                        >
                          <path
                            fill="currentColor"
                            d="M549.655 124.083c-6.281-23.65-24.787-42.276-48.284-48.597C458.781 64 288 64 288 64S117.22 64 74.629 75.486c-23.497 6.322-42.003 24.947-48.284 48.597-11.412 42.867-11.412 132.305-11.412 132.305s0 89.438 11.412 132.305c6.281 23.65 24.787 41.5 48.284 47.821C117.22 448 288 448 288 448s170.78 0 213.371-11.486c23.497-6.321 42.003-24.171 48.284-47.821 11.412-42.867 11.412-132.305 11.412-132.305s0-89.438-11.412-132.305zm-317.51 213.508V175.185l142.739 81.205-142.739 81.201z"
                          ></path></svg
                        ><!-- <i class="fab fa-youtube"></i> Font Awesome fontawesome.com -->
                      </span>
                      <span>Video</span>
                    </a>
                  </span>

                  <!-- Github Link. -->
                  <span class="link-block">
                    <a
                      href="https://github.com/YuliangXiu/ECON"
                      class="external-link button is-normal is-rounded is-dark"
                    >
                      <span class="icon">
                        <i class="fab fa-github"></i>
                      </span>
                      <span>Code</span>
                    </a>
                  </span>
                  <span class="link-block"></span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <section class="hero teaser">
      <div class="container is-max-desktop">
        <div class="hero-body">
          <img src="./static/teaser/teaser.jpg" height="150%" />
          <h2 class="subtitle has-text-centered" style="padding-top: 10px">
            <p align="left">
              <b>Human digitization from a color image.</b>
              ECON combines the best aspects of implicit and explicit surfaces
              to infer high-fidelity 3D humans, even with loose clothing or in
              challenging poses. It does so in three steps: (1) It infers
              detailed 2D normal maps for the front and back side. (2) The
              normal maps are converted into detailed, yet incomplete, 2.5D
              <span style="color: #325ea5"><b>front</b></span> and
              <span style="color: #a58b77"><b>back</b></span> surfaces guided by
              a SMPL-X estimate. (3) It then "inpaints" the
              <span style="color: #10768c"><b>missing geometry</b></span>
              between two surfaces If the
              <span style="color: #dcb7b7"><b>face or hands</b></span> are
              noisy, they can optionally be replaced with the ones from SMPL-X,
              which have a cleaner geometry.
            </p>
          </h2>
        </div>
      </div>
    </section>

    <section class="hero is-light is-small">
      <div class="hero-body">
        <div class="container">
          <div id="results-carousel" class="carousel results-carousel">
            <div class="item item-steve render_wrapper_small">
              <img src="./examples/pose/1af2662b5026ef82ed0e8b08b6698017.png" />
            </div>
            <div class="item item-steve render_wrapper">
              <div id="pose1" class="render_div"></div>
            </div>
            <div class="item item-steve render_wrapper_small">
              <img src="./examples/pose/4ac9ca7a3e34a365c073317f98525add.jpg" />
            </div>
            <div class="item item-steve render_wrapper">
              <div id="pose2" class="render_div"></div>
            </div>
            <div class="item item-steve render_wrapper_small">
              <img src="./examples/pose/4d1ed606c3c0a346c8a75507fc81abff.jpg" />
            </div>
            <div class="item item-steve render_wrapper">
              <div id="pose3" class="render_div"></div>
            </div>

            <div class="item item-steve render_wrapper_small">
              <img src="./examples/pose/5ef3bc939cf82dbd0c541eba41b517c2.jpg" />
            </div>
            <div class="item item-steve render_wrapper">
              <div id="pose4" class="render_div"></div>
            </div>
            <div class="item item-steve render_wrapper_small">
              <img src="./examples/pose/7530ae51e811b1878fae23ea243a3a30.jpg" />
            </div>
            <div class="item item-steve render_wrapper">
              <div id="pose9" class="render_div"></div>
            </div>
            <div class="item item-steve render_wrapper_small">
              <img src="./examples/pose/68757076df6c98e9d6ba6ed00870daef.jpg" />
            </div>
            <div class="item item-steve render_wrapper">
              <div id="pose12" class="render_div"></div>
            </div>
            <div class="item item-steve render_wrapper_small">
              <img src="./examples/pose/d7e876bc5f9e8277d58e30bd83c7452f.jpg" />
            </div>
            <div class="item item-steve render_wrapper">
              <div id="pose15" class="render_div"></div>
            </div>
            <div class="item item-steve render_wrapper_small">
              <img src="./examples/pose/d5241b4de0cebd2722b05d855a5a9ca6.jpg" />
            </div>
            <div class="item item-steve render_wrapper">
              <div id="pose16" class="render_div"></div>
            </div>
          </div>
          <div style="text-align: center">
            ECON on <b>challenging poses</b>&ensp;
            <i class="fas fa-cube fa-2x fa-spin"></i>
          </div>
        </div>
      </div>
    </section>

    <section class="hero is-light is-small">
      <div class="hero-body">
        <div class="container">
          <div id="results-carousel" class="carousel results-carousel">
            <div class="item item-steve render_wrapper_small">
              <img
                src="./examples/cloth/6c0a5def2287d9bfa4a42ee0ce9cb7f9.jpg"
              />
            </div>
            <div class="item item-steve render_wrapper">
              <div id="cloth3" class="render_div"></div>
            </div>
            <div class="item item-steve render_wrapper_small">
              <img
                src="./examples/cloth/55cc162cc4fcda1df2236847a52db93a.jpg"
              />
            </div>
            <div class="item item-steve render_wrapper">
              <div id="cloth6" class="render_div"></div>
            </div>
            <div class="item item-steve render_wrapper_small">
              <img
                src="./examples/cloth/663dcd6db19490de0b790da430bd5681.jpg"
              />
            </div>
            <div class="item item-steve render_wrapper">
              <div id="cloth9" class="render_div"></div>
            </div>
            <div class="item item-steve render_wrapper_small">
              <img
                src="./examples/cloth/2095f20b1390e14d9312913c61c4b621.png"
              />
            </div>
            <div class="item item-steve render_wrapper">
              <div id="cloth11" class="render_div"></div>
            </div>
            <div class="item item-steve render_wrapper_small">
              <img
                src="./examples/cloth/6465c18fc13b862341c33922c79ab490.jpg"
              />
            </div>
            <div class="item item-steve render_wrapper">
              <div id="cloth12" class="render_div"></div>
            </div>
            <div class="item item-steve render_wrapper_small">
              <img
                src="./examples/cloth/c7ca6894119f235caba568a7e01684af.jpg"
              />
            </div>
            <div class="item item-steve render_wrapper">
              <div id="cloth14" class="render_div"></div>
            </div>
            <div class="item item-steve render_wrapper_small">
              <img
                src="./examples/cloth/da135ecd046333c0dc437a383325c90b.jpg"
              />
            </div>
            <div class="item item-steve render_wrapper">
              <div id="cloth15" class="render_div"></div>
            </div>
            <div class="item item-steve render_wrapper_small">
              <img
                src="./examples/cloth/df90cff51a84dd602024ac3aa03ad182.jpg"
              />
            </div>
            <div class="item item-steve render_wrapper">
              <div id="cloth16" class="render_div"></div>
            </div>
          </div>
          <div style="text-align: center">
            ECON on <b>loose clothing</b>&ensp;
            <i class="fas fa-cube fa-2x fa-spin"></i>
          </div>
        </div>
      </div>
    </section>

    <section class="section">
      <div class="container is-max-desktop">
        <!-- Abstract. -->
        <div class="columns is-centered has-text-centered">
          <div class="column is-four-fifths">
            <h2 class="title is-3">Abstract</h2>
            <div class="content has-text-justified">
              <p margin="0">
                The combination of artist-curated scans, and deep implicit
                functions (IF), is enabling the creation of detailed, clothed,
                3D humans from images.
                <span style="color: lightcoral"
                  ><b>However</b>, existing methods are far from perfect.
                  IF-based methods recover free-form geometry but produce
                  disembodied limbs or degenerate shapes for unseen poses or
                  clothes. To increase robustness for these cases, existing work
                  uses an explicit parametric body model to constrain surface
                  reconstruction, but this limits the recovery of free-form
                  surfaces such as loose clothing that deviates from the
                  body.</span
                >
                What we want is a method that combines the best properties of
                implicit and explicit methods.
                <span style="color: forestgreen"
                  ><b>To this end</b>, we make two key observations:(1) current
                  networks are better at inferring detailed 2D maps than full-3D
                  surfaces, and (2) a parametric model can be seen as a “canvas”
                  for stitching together detailed surface patches. ECON infers
                  high-fidelity 3D humans even in <u>loose clothes</u> and
                  <u>challenging poses</u>, while having
                  <u>realistic faces and fingers.</u> This goes beyond previous
                  methods.</span
                >
                Quantitative, evaluation of the CAPE and Renderpeople datasets
                shows that ECON is more accurate than the state of the art.
                Perceptual studies also show that ECON’s perceived realism is
                better by a large margin.
              </p>
            </div>
          </div>
        </div>

        <!-- Paper video. -->
        <div class="columns is-centered has-text-centered">
          <div class="column is-four-fifths">
            <h2 class="title is-3">Video</h2>
            <div class="publication-video">
              <iframe
                src="https://www.youtube.com/embed/j5hw4tsWpoY"
                title="YouTube video player"
                frameborder="0"
                allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                allowfullscreen
              ></iframe>
            </div>
          </div>
        </div>
        <!--/ Paper video. -->
      </div>
    </section>

    <section class="section">
      <div class="container is-max-desktop">
        <!-- Overview. -->
        <div
          class="columns is-centered has-text-centered"
          style="margin-top: 15px"
        >
          <div class="column is-full-width">
            <h2 class="title is-3">Method Overview</h2>
            <img src="./static/teaser/overview.jpg" />
            <div class="content has-text-justified" style="padding-top: 15px">
              ECON takes as input an RGB image, $\mathcal{I}$, and a SMPL-X
              body, $\mathcal{M}^\text{b}$. Conditioned on the rendered front
              and back body normal images, $\mathcal{N}^\text{b}$, ECON first
              predicts front and back clothing normal maps,
              $\hat{\mathcal{N}^\text{c}}$. These two normals along with body
              depth maps, $\mathcal{Z}^\text{b}$, are fed into a d-BiNI
              optimizer to produce front and back surfaces,
              $\{\mathcal{M}_\text{F}, \mathcal{M}_\text{B}\}$. Based on such
              partial surfaces, and body estimate $\mathcal{M}^\text{b}$,
              IF-Nets+ implicitly completes $\mathcal{R}_\text{IF}$. With
              optional face or hands from $\mathcal{M}^\text{b}$, screened
              Poisson combines above all as final watertight $\mathcal{R}$.
            </div>
          </div>
        </div>

        <div
          class="columns is-centered has-text-centered"
          style="margin-top: 15px"
        >
          <div class="column is-full-width">
            <h2 class="title is-3">ECON Applications</h2>
            <table class="bordered">
              <tr>
                <th>
                  <img src="./static/teaser/SHHQ.gif" class="rounded-corners" />
                </th>
                <th>
                  <img
                    src="./static/teaser/crowd.gif"
                    class="rounded-corners"
                  />
                </th>
              </tr>
              <tr>
                <th>
                  Pseudo 3D Ground-truth for
                  <a href="https://stylegan-human.github.io/">SHHQ Dataset</a>
                </th>
                <th>Multi-person Reconstruction</th>
              </tr>
            </table>
          </div>
        </div>

        <br /><br />

        <!-- Concurrent Work. -->
        <div class="columns is-centered has-text-centered">
          <div class="column is-full-width">
            <h2 class="title is-3">Related Links</h2>

            <div class="content has-text-justified">
              <p>
                For more work on similar tasks, please check out the following
                papers.
              </p>
              <ul>
                <li>
                  <a href="https://icon.is.tue.mpg.de/">ICON</a> and
                  <a href="https://github.com/ZhengZerong/PaMIR">PaMIR</a>
                  reconstruct 3D clothed human from single image using Implicit
                  Function and Explicit SMPL mesh.
                </li>
                <li>
                  <a href="https://shunsukesaito.github.io/PIFu/">PIFu</a>,
                  <a href="https://shunsukesaito.github.io/PIFuHD/">PIFuHD</a>
                  and
                  <a href="https://project-splinter.github.io/monoport/"
                    >MonoPort</a
                  >
                  reconstruct them using Implicit Function without introducing
                  any 3D prior.
                </li>
                <li>
                  <a
                    href="https://github.com/hoshino042/bilateral_normal_integration"
                    >BiNI</a
                  >
                  robustly reconstructs 3D surface from a single normal map, and
                  meanwhile preserves the discontinuity.
                </li>
                <li>
                  <a href="https://pixie.is.tue.mpg.de/">PIXIE</a> and
                  <a href="https://www.liuyebin.com/pymaf-x/">PyMAF-X</a>
                  estimate the expressive SMPL-X body from a single image.
                </li>
                <li>
                  <a href="https://virtualhumans.mpi-inf.mpg.de/ifnets/"
                    >IF-Nets</a
                  >
                  completes the partial 3D data using implicit feature networks.
                </li>
                <li>
                  <a href="https://virtualhumans.mpi-inf.mpg.de/gin/"
                    >Any-Shot GIN</a
                  >
                  uses similar sandwich structure to estimate 3D shapes of novel
                  classes from single RGB image.
                </li>
              </ul>
            </div>
          </div>
        </div>
        <!--/ Concurrent Work. -->

        <!-- Acknowledgments. -->
        <div class="columns is-centered has-text-centered">
          <div class="column is-full-width">
            <h2 class="title is-3">Acknowledgments & Disclosure</h2>

            <div class="content has-text-justified">
              We thank
              <a href="https://is.mpg.de/person/lhering">Lea Hering</a> and
              <a href="https://is.mpg.de/person/rdanecek">Radek Daněček</a> for
              proof reading,
              <a href="https://ps.is.mpg.de/person/yfeng">Yao Feng</a>,
              <a href="https://is.mpg.de/person/hfeng">Haven Feng</a>, and
              <a href="https://wyliu.com/">Weiyang Liu</a> for their feedback
              and discussions,
              <a href="https://ps.is.mpg.de/person/talexiadis"
                >Tsvetelina Alexiadis</a
              >
              for her help with the AMT perceptual study. This project has
              received funding from the European Union’s Horizon 2020 research
              and innovation programme under the Marie Skłodowska-Curie grant
              agreement No.860768 (<a href="https://www.clipe-itn.eu/"
                >CLIPE Project</a
              >). <br /><br/>
              MJB has received research gift funds from Adobe, Intel, Nvidia,
              Meta/Facebook, and Amazon. MJB has financial interests in Amazon,
              Datagen Technologies, and Meshcapade GmbH. While MJB is a
              part-time employee of Meshcapade, his research was performed
              solely at, and funded solely by, the Max Planck Society.
            </div>
          </div>
        </div>
        <!-- Acknowledgments. -->
      </div>
    </section>

    <section class="section" id="BibTeX">
      <div class="container is-max-desktop content">
        <h2 class="title">BibTeX</h2>
        <pre>
<code>@misc{xiu2022econ,
    title={{ECON: Explicit Clothed humans Obtained from Normals}},
    author={Xiu, Yuliang and Yang, Jinlong and Cao, Xu and Tzionas, Dimitrios and Black, Michael J.},
    year={2022}
    publisher={arXiv},
    primaryClass={cs.CV}
}</code></pre>
      </div>
    </section>

    <footer class="footer">
      <div class="container">
        <div class="content has-text-centered">
          <a class="icon-link" href="">
            <i class="fas fa-file-pdf"></i>
          </a>
          <a
            class="icon-link"
            href="https://github.com/YuliangXiu/ECON"
            class="external-link"
            disabled
          >
            <i class="fab fa-github"></i>
          </a>
        </div>
        <div class="columns is-centered">
          <div class="column is-8">
            <div class="content">
              <p style="text-align: center">
                Source code mainly borrowed from
                <a href="https://keunhong.com/">Keunhong Park</a>'s
                <a href="https://nerfies.github.io/">Nerfies website</a> and
                <a href="https://simongiebenhain.github.io/"
                  >Simon Giebenhain's</a
                >
                adoption for
                <a href="https://simongiebenhain.github.io/NPHM/">NPHM</a>.
              </p>
              <p style="text-align: center">
                For technical questions, please contact
                <a href="mailto: yuliang.xiu@tue.mpg.de">Yuliang Xiu</a><br />
                For commercial licensing, please contact
                <a href="mailto: ps-licensing@tue.mpg.de">ps-licensing</a>
              </p>
            </div>
          </div>
        </div>
      </div>
    </footer>

    <!-- Import maps polyfill -->
    <!-- Remove this when import maps will be widely supported -->
    <script
      async
      src="https://unpkg.com/es-module-shims@1.3.6/dist/es-module-shims.js"
    ></script>

    <script type="importmap">
      {
        "imports": {
          "three": "./js/three.module.js"
        }
      }
    </script>

    <script type="module">
      import * as THREE from "three";

      import { PLYLoader } from "./js/PLYLoader.js";
      import { OrbitControls } from "./js/OrbitControls.js";
      let div_to_scene = {
        pose1: {
          geo: null,
        },
        pose2: {
          geo: null,
        },
        pose3: {
          geo: null,
        },
        pose4: {
          geo: null,
        },
        pose5: {
          geo: null,
        },
        pose6: {
          geo: null,
        },
        pose7: {
          geo: null,
        },
        pose8: {
          geo: null,
        },
        pose9: {
          geo: null,
        },
        pose10: {
          geo: null,
        },
        pose11: {
          geo: null,
        },
        pose12: {
          geo: null,
        },
        pose13: {
          geo: null,
        },
        pose14: {
          geo: null,
        },
        pose15: {
          geo: null,
        },
        pose16: {
          geo: null,
        },

        cloth1: {
          geo: null,
        },
        cloth2: {
          geo: null,
        },
        cloth3: {
          geo: null,
        },
        cloth4: {
          geo: null,
        },
        cloth5: {
          geo: null,
        },
        cloth6: {
          geo: null,
        },
        cloth7: {
          geo: null,
        },
        cloth8: {
          geo: null,
        },
        cloth9: {
          geo: null,
        },
        cloth10: {
          geo: null,
        },
        cloth11: {
          geo: null,
        },
        cloth12: {
          geo: null,
        },
        cloth13: {
          geo: null,
        },
        cloth14: {
          geo: null,
        },
        cloth15: {
          geo: null,
        },
        cloth16: {
          geo: null,
        },
        cloth17: {
          geo: null,
        },
      };
      let mouse_button_down = false;
      let list_of_orbit_controls = [];
      let style_camera = null;
      let render_colors = true;
      let style_id = "0";

      function setup_camera(div_name) {
        let container = document.getElementById(div_name);
        let width = container.parentElement.clientWidth;
        let height = container.parentElement.clientHeight;
        console.log(width, height);
        let camera = new THREE.PerspectiveCamera(35, width / height, 0.1, 50);
        let camera_init_position = new THREE.Vector3(0, 0, 2.2);
        camera_init_position = camera_init_position.multiplyScalar(1.5);
        //if (div_name.includes("style")) {
        //    camera_init_position = camera_init_position.multiplyScalar(1.25)
        //}
        //else if (div_name.includes("style")) {
        //    camera_init_position = camera_init_position.multiplyScalar(1.25)
        //}
        camera.position.set(
          camera_init_position.x,
          camera_init_position.y,
          camera_init_position.z
        );
        return camera;
      }

      function setup_render_divs(div_name, mesh_path) {
        let camera = setup_camera(div_name);
        let orbit_control = create_render_div(camera, div_name, mesh_path);
        list_of_orbit_controls.push(orbit_control);
      }

      function create_render_div(camera, div_id, mesh_path) {
        let container;
        let renderer, controls;

        init();
        animate();

        function init() {
          container = document.getElementById(div_id);
          let width = container.parentElement.clientWidth;
          let height = container.parentElement.clientHeight;

          div_to_scene[div_id]["geo"] = new THREE.Scene();
          div_to_scene[div_id]["geo"].background = new THREE.Color(0xffffff);
          //var axesHelper = new THREE.AxesHelper( 5 );
          //div_to_scene[div_id]["geo"].add( axesHelper );

          // PLY file

          const loader = new PLYLoader();
          loader.load(
            mesh_path,
            function (geometry) {
              geometry.computeVertexNormals();
              const material_geo = new THREE.MeshPhongMaterial({
                color: 0xcce6ff,
                specular: 0x222222,
                shininess: 25,
              });

              const mesh_geo = new THREE.Mesh(geometry, material_geo);
              //mesh_geo.castShadow = true;
              //mesh_geo.receiveShadow = true;
              div_to_scene[div_id]["geo"].add(mesh_geo);
            },
            (xhr) => {
              console.log((xhr.loaded / xhr.total) * 100 + "% loaded");
            },
            (error) => {
              console.log(error);
            }
          );

          // lights

          add_lights(div_to_scene[div_id]["geo"]);

          // renderer

          renderer = new THREE.WebGLRenderer({ antialias: true });
          renderer.setPixelRatio(window.devicePixelRatio);
          renderer.setSize(width, height);
          renderer.outputEncoding = THREE.sRGBEncoding;

          //renderer.shadowMap.enabled = true;

          container.appendChild(renderer.domElement);

          controls = new OrbitControls(camera, renderer.domElement);
          controls.enableDamping = false;
          controls.autoRotate = true;

          // resize

          window.addEventListener("resize", onWindowResize);
          //controls.addEventListener('change', onChange)
          controls.addEventListener("start", function () {
            //clearTimeout(autorotateTimeout);
            controls.autoRotate = false;
          });

          // restart autorotate after the last interaction & an idle time has passed
          //this.controls.addEventListener('end', function(){
          //  autorotateTimeout = setTimeout(function(){
          //    controls.autoRotate = true;
          //  }, 1000);
          //});
        }
        function onWindowResize() {
          let width = container.clientWidth;
          let height = container.clientHeight;
          camera.aspect = width / height;
          camera.updateProjectionMatrix();
          renderer.setSize(width, height);
        }
        function animate() {
          requestAnimationFrame(animate);
          controls.update();
          render();
        }

        function render() {
          renderer.render(div_to_scene[div_id]["geo"], camera);
          controls.update();
        }

        return controls;
      }

      function add_lights(scene) {
        scene.add(new THREE.HemisphereLight(0x443333, 0x111122, 0.05));
        const spotLight = new THREE.SpotLight(0xffffff, 0.5);
        spotLight.position.set(0.0, 0.5, 1);
        const spotLight2 = new THREE.SpotLight(0xffffff, 0.25);
        spotLight2.position.set(-2, 0.3, -0.2);
        const spotLight3 = new THREE.SpotLight(0xffffff, 0.25);
        spotLight3.position.set(2, -0.3, 0.2);
        const spotLight4 = new THREE.SpotLight(0xffffff, 0.25);
        spotLight4.position.set(0.0, 1, -2);
        const spotLight5 = new THREE.SpotLight(0xffffff, 0.05);
        spotLight5.position.set(0, -2.5, -1);
        spotLight.position.multiplyScalar(10);
        scene.add(spotLight);
        scene.add(spotLight2);
        scene.add(spotLight3);
        scene.add(spotLight4);
        scene.add(spotLight5);
      }

      document.addEventListener("keydown", logKey);

      function logKey(evt) {
        if (evt.keyCode === 71 && !mouse_button_down) {
          switch_geometry();
        }
        if (evt.keyCode === 82 && !mouse_button_down) {
          reset_orbit_controls();
        }
      }

      function switch_geometry() {
        render_colors = !render_colors;
      }

      function reset_orbit_controls() {
        list_of_orbit_controls.forEach((oc) => {
          oc.reset();
          oc.autoRotate = false;
        });
      }

      function set_style_0() {
        style_id = "0";
      }

      function set_style_1() {
        style_id = "1";
      }

      function set_style_2() {
        style_id = "2";
      }

      function set_style_3() {
        style_id = "3";
      }

      function set_style_4() {
        style_id = "4";
      }
      function set_style_5() {
        style_id = "5";
      }
      function set_style_6() {
        style_id = "6";
      }

      document.body.onmousedown = function (evt) {
        if (evt.button === 0) mouse_button_down = true;
      };
      document.body.onmouseup = function (evt) {
        if (evt.button === 0) mouse_button_down = false;
      };

      window.onload = function () {
        let slider = document.getElementsByClassName("slider")[0];
        slider.removeAttribute("tabIndex");
        setup_render_divs(
          "pose1",
          "./models/pose/1af2662b5026ef82ed0e8b08b6698017_0_full.ply"
        );
        setup_render_divs(
          "pose2",
          "./models/pose/4ac9ca7a3e34a365c073317f98525add_0_full.ply"
        );
        setup_render_divs(
          "pose3",
          "./models/pose/4d1ed606c3c0a346c8a75507fc81abff_0_full.ply"
        );
        setup_render_divs(
          "pose4",
          "./models/pose/5ef3bc939cf82dbd0c541eba41b517c2_0_full.ply"
        );
        setup_render_divs(
          "pose9",
          "./models/pose/7530ae51e811b1878fae23ea243a3a30_0_full.ply"
        );
        setup_render_divs(
          "pose12",
          "./models/pose/68757076df6c98e9d6ba6ed00870daef_0_full.ply"
        );
        setup_render_divs(
          "pose15",
          "./models/pose/d7e876bc5f9e8277d58e30bd83c7452f_0_full.ply"
        );
        setup_render_divs(
          "pose16",
          "./models/pose/d5241b4de0cebd2722b05d855a5a9ca6_0_full.ply"
        );

        setup_render_divs(
          "cloth3",
          "./models/cloth/6c0a5def2287d9bfa4a42ee0ce9cb7f9_0_full.ply"
        );
        setup_render_divs(
          "cloth6",
          "./models/cloth/55cc162cc4fcda1df2236847a52db93a_0_full.ply"
        );
        setup_render_divs(
          "cloth9",
          "./models/cloth/663dcd6db19490de0b790da430bd5681_0_full.ply"
        );
        setup_render_divs(
          "cloth11",
          "./models/cloth/2095f20b1390e14d9312913c61c4b621_0_full.ply"
        );
        setup_render_divs(
          "cloth12",
          "./models/cloth/6465c18fc13b862341c33922c79ab490_0_full.ply"
        );
        setup_render_divs(
          "cloth14",
          "./models/cloth/c7ca6894119f235caba568a7e01684af_0_full.ply"
        );
        setup_render_divs(
          "cloth15",
          "./models/cloth/da135ecd046333c0dc437a383325c90b_0_full.ply"
        );
        setup_render_divs(
          "cloth16",
          "./models/cloth/df90cff51a84dd602024ac3aa03ad182_0_full.ply"
        );
      };
    </script>
  </body>
</html>
